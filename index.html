<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÊòéÊó•„ÅÆÈÅãÂã¢„Ç¨„ÉÅ„É£</title>
  <style>
    :root{
      --bg: #0f172a;
      --panel: #101625cc;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #fbbf24;
      --accent2:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;display:grid;place-items:center;background:radial-gradient(80vw 80vh at 50% -10%,#182236,#0b1220);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans JP,sans-serif;color:var(--text)}
    .card{width:min(720px,94vw);background:linear-gradient(180deg,#0b1220dd,#0b1220b0);border:1px solid #1f2937;border-radius:20px;padding:24px 20px;box-shadow:0 10px 30px #0008}
    h1{margin:6px 0 6px;font-size:clamp(22px,4vw,28px)}
    p.sub{margin:0 0 12px;color:var(--muted);font-size:14px}
    .stage{position:relative;height:300px;border-radius:16px;background:linear-gradient(180deg,#0b1220,#0b1226);border:1px dashed #334155;overflow:hidden;display:grid;place-items:center}
    .cookieWrap{position:absolute;top:-200px;width:220px;height:200px;display:grid;place-items:center;pointer-events:none}
    .cookieWrap.drop{animation:drop 900ms cubic-bezier(.2,.9,.2,1) forwards}
    @keyframes drop{0%{transform:translateY(-220px) scale(.9) rotate(-6deg)}70%{transform:translateY(260px) scale(1) rotate(4deg)}100%{transform:translateY(220px) rotate(0deg)}}
    .cookieWrap.bob{animation:bob 2.4s ease-in-out infinite}
    @keyframes bob{0%,100%{transform:translateY(220px)}50%{transform:translateY(214px)}}
    .cookie.crack{animation:crack 500ms ease forwards}
    @keyframes crack{0%{filter:drop-shadow(0 6px 12px #0008)}100%{filter:drop-shadow(0 16px 26px #0008)}}
    .leftHalf.fly{animation:flyL 650ms cubic-bezier(.2,.7,.1,1) forwards}
    .rightHalf.fly{animation:flyR 650ms cubic-bezier(.2,.7,.1,1) forwards}
    @keyframes flyL{to{transform:translate(-120px,-30px) rotate(-22deg)}}
    @keyframes flyR{to{transform:translate(120px,-10px) rotate(22deg)}}
    .slip{position:absolute;bottom:120px;left:50%;transform:translate(-50%,40px) rotate(-2deg);min-width:260px;background:#fff;color:#111;border-radius:6px;padding:10px 14px;border:1px solid #e5e7eb;box-shadow:0 10px 20px #0007;opacity:0}
    .slip.show{animation:slipOut 700ms cubic-bezier(.2,.8,.2,1) forwards}
    @keyframes slipOut{from{opacity:0;transform:translate(-50%,60px) rotate(-4deg)}to{opacity:1;transform:translate(-50%,-10px) rotate(0deg)}}
    .slip .label{font-size:12px;color:#6b7280}
    .slip .fortune{font-weight:800;font-size:20px;letter-spacing:.02em}
    .slip .tip{margin-top:4px;font-size:12px;color:#4b5563}
    .btns{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
    button{appearance:none;border:none;border-radius:14px;padding:12px 16px;cursor:pointer;font-weight:700;letter-spacing:.02em;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#3a2200;transition:transform .08s ease,box-shadow .08s ease;box-shadow:0 6px 16px #0008}
    button:hover{transform:translateY(-1px)}
    button:active{transform:translateY(1px)}
    button.secondary{background:#0f172a;color:#cbd5e1;border:1px solid #334155}
    .history{margin-top:14px;font-size:13px;color:var(--muted)}
    .history ul{margin:6px 0 0;padding-left:18px;max-height:140px;overflow:auto}
    .counter{font-size:12px;color:var(--muted);margin-top:4px}
    footer{margin-top:16px;font-size:12px;color:#748096}
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>ÊòéÊó•„ÅÆÈÅãÂã¢„Ç¨„ÉÅ„É£</h1>
    <p class="sub">„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„ÇØ„ÉÉ„Ç≠„Éº„ÅåÈôç„Çä„Å¶Ââ≤„Çå„Å¶„ÄÅ„Åä„Åø„Åè„Åò„ÅåÂá∫„Çã„ÄÇ</p>
    <section class="stage" aria-live="polite" aria-atomic="true">
      <div class="cookieWrap" id="cookieWrap" aria-hidden="true">
        <svg id="cookieSvg" class="cookie" width="200" height="160" viewBox="0 0 200 160">
          <defs>
            <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="#fbbf24"/>
              <stop offset="100%" stop-color="#d97706"/>
            </linearGradient>
          </defs>
          <g id="cookieGroup">
            <path id="whole" d="M30 100c0-38 38-70 70-70s70 32 70 70c0 18-14 28-30 28-14 0-26-6-40-6s-26 6-40 6c-16 0-30-10-30-28z" fill="url(#g1)" stroke="#b45309" stroke-width="2"/>
            <path id="crack" d="M100 36 L100 126" stroke="#b45309" stroke-width="2" stroke-dasharray="6 6" opacity="0"/>
          </g>
          <g id="leftHalf" class="leftHalf" opacity="0">
            <path d="M30 100c0-38 38-70 70-70v88c-14 0-26 6-40 6-16 0-30-10-30-24z" fill="url(#g1)" stroke="#b45309" stroke-width="2"/>
          </g>
          <g id="rightHalf" class="rightHalf" opacity="0">
            <path d="M100 30c32 0 70 32 70 70 0 14-14 24-30 24-14 0-26-6-40-6V30z" fill="url(#g1)" stroke="#b45309" stroke-width="2"/>
          </g>
        </svg>
      </div>
      <div class="slip" id="slip">
        <div class="label">„Åä„Åø„Åè„Åò</div>
        <div class="fortune" id="slipFortune">‚Äî</div>
        <div class="tip" id="slipTip"></div>
      </div>
    </section>
    <div class="btns">
      <button id="roll">ÊòéÊó•„ÅÆÈÅãÂã¢„ÇíÂºï„Åè</button>
      <button id="copy" class="secondary">„Ç≥„Éî„Éº</button>
      <button id="share" class="secondary">„Ç∑„Çß„Ç¢</button>
      <button id="reset" class="secondary">Â±•Ê≠¥„ÇØ„É™„Ç¢</button>
    </div>
    <div class="counter" id="counter">Âõû„Åó„ÅüÂõûÊï∞: 0</div>
    <div class="history" id="history">Â±•Ê≠¥<ul id="histList"></ul></div>
    <footer><span id="footerDate"></span></footer>
  </main>

<script>
  const FORTUNES = [
    { name: 'Â§™ÈôΩÂêâ', emoji: '‚òÄ', tip: 'ÊúùËµ∑„Åç„Åü„ÇâÂ§™ÈôΩ„ÇíÊµ¥„Å≥„Çà„ÅÜÔºÅ1Êó•„ÅÆ„ÅÑ„ÅÑ„Çπ„Çø„Éº„Éà„Åå„Åç„Çå„Çã„ÇàÔΩû' },
    { name: 'ÊµÅÊòüÂêâ', emoji: 'üå†', tip: 'ÊÄù„ÅÑ„Å§„ÅÑ„ÅüÂ•áË∑°„ÅØÂøò„Çå„Å™„ÅÑ„ÅÜ„Å°„Å´„É°„É¢ÔºÅÊ¨°„ÅÆËªåË∑°„Å´„Å™„Çã„ÇàÔºÅ' },
    { name: 'Á¨ëÈ°îÂêâ', emoji: 'üòÜ', tip: 'Èè°„ÇíË¶ã„Å¶„Éã„Ç≥„Å£„Å¶„Åó„Çà„ÅÜÔºÅÊ¥ªÂäõ„Ç¢„ÉÉ„Éó„Åô„Çã„ÇàÔºÅ' },
    { name: 'ÂÜíÈô∫Âêâ', emoji: 'üö∂‚Äç‚ôÇÔ∏è‚Äç‚û°Ô∏è', tip: '„ÅÑ„Å§„ÇÇ„Å®ÈÅï„ÅÜÈÅì„ÇíÊ≠©„Åì„ÅÜÔºÅÊñ∞„Åó„ÅÑÁô∫Ë¶ã„Åå„ÅÇ„Çã„Åã„ÇÇÔºü' },
    { name: 'È¢®Âêâ', emoji: 'üçÉ', tip: 'Â§ñ„ÅßÈ¢®„ÇíÊÑü„Åò„Å¶„Åø„Å¶ÔºÅÂè∞È¢®„ÅåÊù•„Çã„Åã„ÇÇÔΩû' },
    { name: '„Ç´„Éï„ÇßÂêâ', emoji: '‚òï', tip: '„Å≤„Å®„ÇÑ„Åô„Åø„Åó„Å¶„ÇãÔºüÊòéÊó•„ÅØ„Åª„Å£„Å®‰∏ÄÊÅØ„Å§„Åì„ÅÜ„Å≠ÔΩû' },
    { name: 'Â§©ÊâçÂêâ', emoji: 'üß†', tip: 'ÊÄù„ÅÑ„ÇÇ„Çà„Çâ„Å¨„Ç¢„Ç§„Éá„Ç¢„ÅåÈôç„Çä„Å¶„Åç„Åù„ÅÜÔºÅ„Åù„Çì„Å™„ÅÇ„Å™„Åü„ÅØÂ§©ÊâçÔºÅ' },
    { name: '„ÅäÂñã„ÇäÂêâ', emoji: 'üí¨', tip: 'Ë™∞„Åã„Å®Ë©±„Åô„Å®„ÄÅÂøÉ„ÅåËªΩ„Åè„Å™„Å£„Å¶È£õ„Åπ„Çã„Åã„ÇÇ„ÇàÔºÅ' },
    { name: 'Êï£Ê≠©Âêâ', emoji: 'üêæ', tip: '„ÅäÊï£Ê≠©„Åó„Å´Â§ñ„Å´Âá∫„Çà„ÅÜÔºÅÈáëÊú®ÁäÄ„ÅÆÈ¶ô„Çä„ÇíÂóÖ„Åí„Çã„ÉÅ„É£„É≥„ÇπÔºÅ' },
    { name: 'ÊñôÁêÜÂêâ', emoji: 'üç≥', tip: '‰Ωï„Åã‰Ωú„Çç„ÅÜÔºÅÊÄù„ÅÑ„ÇÇ„Çà„Çâ„Å¨„Åä„ÅÑ„Åó„ÅÑÂë≥‰ªò„Åë„ÅåË¶ã„Å§„Åã„Çã‰∫àÊÑüÔºÅ' }
  ];

  const $ = sel => document.querySelector(sel);
  const wait = ms => new Promise(r=>setTimeout(r,ms));
  const counterEl = $('#counter');
  const histList = $('#histList');
  const slip = $('#slip');
  const slipFortune = $('#slipFortune');
  const slipTip = $('#slipTip');
  const cookieWrap = $('#cookieWrap');
  const cookieSvg = $('#cookieSvg');
  const crackPath = $('#crack');
  const leftHalf = $('#leftHalf');
  const rightHalf = $('#rightHalf');
  let state = JSON.parse(localStorage.getItem('tomorrow_fortune_v1')||'{"count":0,"history":[]}');
  const PUBLIC_URL = 'https://gogogobolder.github.io/fortune-cookie/';

  function chooseFortune(){
    const f = FORTUNES[Math.floor(Math.random()*FORTUNES.length)];
    slipFortune.textContent = `${f.emoji} ${f.name}`;
    slipTip.textContent = f.tip;
    return f;
  }

  function stamp(){const d=new Date();return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()} ${d.getHours()}:${d.getMinutes()}`;}
  function render(){counterEl.textContent=`Âõû„Åó„ÅüÂõûÊï∞: ${state.count}`;histList.innerHTML=state.history.map(h=>`<li>${h.time}Ôºö${h.label}</li>`).join('');}

  function once(el, event){return new Promise(res=>{const h=()=>{el.removeEventListener(event,h);res();};el.addEventListener(event,h);});}
  function onceWithTimeout(el, event, ms){return new Promise(res=>{let done=false;const h=()=>{if(done)return;done=true;el.removeEventListener(event,h);res();};el.addEventListener(event,h);setTimeout(()=>{if(done)return;done=true;el.removeEventListener(event,h);res();},ms);});}

  async function animateCookie(){
    slip.classList.remove('show');
    slipFortune.textContent='‚Äî';
    slipTip.textContent='';
    crackPath.style.opacity=0;
    leftHalf.style.opacity=0; rightHalf.style.opacity=0;
    cookieSvg.style.opacity=1; cookieSvg.classList.remove('crack');
    cookieWrap.classList.remove('bob');
    cookieWrap.classList.remove('drop'); void cookieWrap.offsetWidth;
    const pDrop=onceWithTimeout(cookieWrap,'animationend',1100);
    cookieWrap.classList.add('drop');
    await pDrop; cookieWrap.classList.add('bob');
    crackPath.style.opacity=.9; cookieSvg.classList.add('crack');
    navigator.vibrate?.(40); await wait(200);
    crackPath.style.opacity=0; cookieSvg.style.opacity=0;
    leftHalf.style.opacity=1; rightHalf.style.opacity=1;
    leftHalf.classList.remove('fly'); rightHalf.classList.remove('fly');
    void leftHalf.offsetWidth;
    const pL=onceWithTimeout(leftHalf,'animationend',800);
    const pR=onceWithTimeout(rightHalf,'animationend',800);
    leftHalf.classList.add('fly'); rightHalf.classList.add('fly');
    await Promise.all([pL,pR]);
    chooseFortune();
    slip.classList.remove('show'); void slip.offsetWidth; slip.classList.add('show');
  }

  async function roll(){
    const btn=document.getElementById('roll');
    btn.disabled=true; btn.style.opacity=.7;
    try{
      await animateCookie();
      state.count++;
      state.history.unshift({time:stamp(),label:slipFortune.textContent});
      state.history=state.history.slice(0,20);
      localStorage.setItem('tomorrow_fortune_v1',JSON.stringify(state));
      render();
    }finally{btn.disabled=false; btn.style.opacity='';}
  }

  $('#roll').addEventListener('click', roll);
  $('#copy').addEventListener('click', async()=>{const text=`ÊòéÊó•„ÅÆÈÅãÂã¢Ôºö${slipFortune.textContent}Ôºà„Éí„É≥„ÉàÔºö${slipTip.textContent}Ôºâ`;await navigator.clipboard.writeText(text).catch(()=>alert('„Ç≥„Éî„Éº„Åß„Åç„Å™„Åã„Å£„Åü‚Ä¶'));});
  $('#share').addEventListener('click', async () => {
    const text = `ÊòéÊó•„ÅÆÈÅãÂã¢Ôºö${document.getElementById('slipFortune').textContent}`;
    const url  = PUBLIC_URL;
    try{
      if(navigator.share){
        await navigator.share({ title:'ÊòéÊó•„ÅÆÈÅãÂã¢„Ç¨„ÉÅ„É£', text, url });
      }else{
        await navigator.clipboard.writeText(`${text}\n${url}`);
        alert('„É™„É≥„ÇØ‰ªò„Åç„Åß„Ç≥„Éî„Éº„Åó„Åü„Çà');
      }
    }catch{}
  });
  $('#reset').addEventListener('click',()=>{state={count:0,history:[]};localStorage.setItem('tomorrow_fortune_v1',JSON.stringify(state));render();slip.classList.remove('show');});
  render();
  document.getElementById('footerDate').textContent=`¬© ${new Date().getFullYear()} Tomorrow Fortune Gacha`;
</script>
</body>
</html>
